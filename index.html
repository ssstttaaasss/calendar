<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>Minimal Apple-Style Calendar</title>
  <style>
    /* БАЗОВИЙ CSS (темна тема, мінімальні відступи) */
    html, body {
      margin: 0;
      padding: 0;
      background-color: #1e1e1e; /* Темний фон */
      color: #f2f2f2;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, 
                   "Helvetica Neue", Arial, sans-serif;
      height: 100%;
      width: 100%;
      box-sizing: border-box;
    }

    /* Головний контейнер */
    .container {
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: flex-start;
      gap: 30px;
      padding: 40px 20px;
      max-width: 900px;
      margin: 0 auto;
    }

    /* Календар */
    .calendar-container {
      background: #2a2a2a;
      border-radius: 16px;
      padding: 20px;
      min-width: 360px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.4);
    }

    .calendar-container h1 {
      text-align: center;
      margin: 0;
      padding: 0;
      font-weight: 600;
      font-size: 1.6rem;
      letter-spacing: 0.5px;
      margin-bottom: 10px;
    }

    /* Тонка лінія під заголовком */
    .month-separator {
      border: none;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      margin: 0 0 15px;
    }

    /* Таблиця календаря */
    #calendarTable {
      width: 100%;
      border-collapse: collapse;
      text-align: center;
    }
    #calendarTable thead th {
      font-weight: 500;
      color: #888;
      padding-bottom: 6px;
    }
    #calendarTable tbody td {
      height: 48px;
      cursor: default;
      position: relative;
      user-select: none;
      font-size: 0.95rem;
      color: #f2f2f2;
      transition: background-color 0.2s, color 0.2s;
    }

    /* Минулі дні (сірий колір і закреслено) */
    .past-day {
      text-decoration: line-through;
      color: #555 !important;
      cursor: not-allowed;
    }

    /* Виділені дні (наприклад, контекстним кліком) */
    .highlighted {
      position: relative;
      color: #fff !important;
    }
    .highlighted::before {
      content: "";
      position: absolute;
      width: 36px;
      height: 36px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: rgba(255, 100, 150, 0.3); /* рожевий кружечок */
      border-radius: 50%;
      z-index: -1;
    }

    /* Віджет справа */
    .date-widget {
      background: #2a2a2a;
      width: 120px;
      height: 120px;
      border-radius: 16px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.4);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
      padding: 10px;
      box-sizing: border-box;
    }

    .day-number {
      font-size: 2.2rem;
      font-weight: 700;
      line-height: 1;
    }
    .month-name {
      font-size: 1rem;
      font-weight: 400;
      text-transform: uppercase;
    }

    @media (max-width: 600px) {
      .container {
        flex-direction: column;
        align-items: center;
      }
      .calendar-container {
        width: 90%;
        min-width: auto;
      }
      .date-widget {
        margin-top: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Календар -->
    <div class="calendar-container">
      <h1 id="calendarTitle"></h1>
      <hr class="month-separator" />
      
      <table id="calendarTable">
        <thead>
          <tr>
            <th>Пн</th>
            <th>Вт</th>
            <th>Ср</th>
            <th>Чт</th>
            <th>Пт</th>
            <th>Сб</th>
            <th>Нд</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Невеликий квадрат з датою (праворуч) -->
    <div class="date-widget" id="dateWidget">
      <div class="day-number" id="widgetDay">--</div>
      <div class="month-name" id="widgetMonth">---</div>
    </div>
  </div>

  <script>
    /**************************************************
      1. ВИЗНАЧЕННЯ ПОТОЧНОГО МІСЯЦЯ ТА РОКУ
    **************************************************/
    const today = new Date();
    const currentYear = today.getFullYear();
    const currentMonth = today.getMonth(); // 0..11

    /**************************************************
      2. ПІДГОТОВКА ЕЛЕМЕНТІВ
    **************************************************/
    const calendarTitle = document.getElementById('calendarTitle');
    const calendarTableBody = document.querySelector('#calendarTable tbody');

    const widgetDayEl = document.getElementById('widgetDay');
    const widgetMonthEl = document.getElementById('widgetMonth');

    // Збереження/завантаження виділених днів з LocalStorage
    let highlightedDays = JSON.parse(localStorage.getItem('highlightedDays_v5')) || {};

    /**************************************************
      3. ФУНКЦІЯ ГЕНЕРАЦІЇ КАЛЕНДАРЯ
    **************************************************/
    function generateCalendar(year, month) {
      // Очищаємо попередні ряди
      calendarTableBody.innerHTML = '';

      // Назва місяця та року (українською, з великої літери)
      const monthName = new Date(year, month).toLocaleString('uk-UA', {
        month: 'long',
        year: 'numeric'
      });
      calendarTitle.textContent =
        monthName.charAt(0).toUpperCase() + monthName.slice(1) + ' р.';

      // Знайдемо день тижня для 1-го числа (JS: 0=неділя, 1=понеділок, ...)
      const firstDay = new Date(year, month, 1).getDay();
      // Зробимо так, що Пн=0, Вт=1... Нд=6
      // (Для цього трохи «зсуваємо», якщо треба)
      const offset = (firstDay + 6) % 7;

      // Кількість днів у цьому місяці
      const totalDays = new Date(year, month + 1, 0).getDate();

      let currentDay = 1;
      // Макс 6 рядків (тижнів) у місяці
      for (let rowIndex = 0; rowIndex < 6; rowIndex++) {
        const row = document.createElement('tr');

        for (let colIndex = 0; colIndex < 7; colIndex++) {
          const cell = document.createElement('td');

          // Якщо ще не дійшли до початку місяця або вже «вийшли» за totalDays
          if ((rowIndex === 0 && colIndex < offset) || currentDay > totalDays) {
            cell.textContent = '';
          } else {
            cell.textContent = currentDay;

            // Генеруємо ключ для LocalStorage
            const dateKey = `${year}-${String(month+1).padStart(2,'0')}-${String(currentDay).padStart(2,'0')}`;
            cell.dataset.date = dateKey;

            // Перевірити, чи цей день у минулому
            const cellDate = new Date(year, month, currentDay);
            const isPast = cellDate < new Date(today.getFullYear(), today.getMonth(), today.getDate());
            if (isPast) {
              // Закреслення
              cell.classList.add('past-day');
            } else {
              // Якщо день не в минулому: можна виділяти через контекстне меню
              cell.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                toggleHighlight(cell);
              });
              // При кліку – оновлюємо віджет праворуч
              cell.addEventListener('click', () => {
                updateDateWidget(dateKey);
              });
            }

            // Якщо день уже виділений
            if (highlightedDays[dateKey]) {
              cell.classList.add('highlighted');
            }

            currentDay++;
          }
          row.appendChild(cell);
        }
        calendarTableBody.appendChild(row);
      }
    }

    /**************************************************
      4. ПЕРЕМИКАННЯ ВИДІЛЕННЯ (highlight)
    **************************************************/
    function toggleHighlight(cell) {
      const dateKey = cell.dataset.date;
      if (!dateKey) return;

      if (cell.classList.contains('highlighted')) {
        cell.classList.remove('highlighted');
        delete highlightedDays[dateKey];
      } else {
        cell.classList.add('highlighted');
        highlightedDays[dateKey] = true;
      }
      localStorage.setItem('highlightedDays_v5', JSON.stringify(highlightedDays));
    }

    /**************************************************
      5. ОНОВЛЕННЯ ВІДЖЕТУ ПРАВОРУЧ (ДЕНЬ/МІСЯЦЬ)
    **************************************************/
    function updateDateWidget(dateKey) {
      if (!dateKey) return;
      const [yyyy, mm, dd] = dateKey.split('-');
      widgetDayEl.textContent = dd; // наприклад, '05'

      // Скорочена назва місяця (uk-UA)
      const shortMonth = new Date(parseInt(yyyy), parseInt(mm)-1, parseInt(dd))
        .toLocaleString('uk-UA', { month: 'short' })
        .replace('.', ''); // Іноді з'являється крапка
      widgetMonthEl.textContent = shortMonth.toUpperCase(); // 'СІЧ'
    }

    /**************************************************
      6. СТАРТ: генеруємо календар, ставимо сьогоднішню дату у віджет
    **************************************************/
    generateCalendar(currentYear, currentMonth);

    // За замовчуванням показуємо сьогоднішню дату у віджеті
    const todayKey = `${currentYear}-${String(currentMonth+1).padStart(2,'0')}-${String(today.getDate()).padStart(2,'0')}`;
    const todayCell = document.querySelector(`td[data-date="${todayKey}"]`);
    if (todayCell && !todayCell.classList.contains('past-day')) {
      updateDateWidget(todayKey);
    }
  </script>
</body>
</html>
